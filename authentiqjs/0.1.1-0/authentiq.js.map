{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/authentiq.js","src/polyfills.js","src/utils.js","src/api.js","src/button.js","src/provider.js","src/token.js","src/session.js","node_modules/radio/radio.js","node_modules/query-string/index.js","node_modules/object-assign/index.js","node_modules/strict-uri-encode/index.js"],"names":["require","radio","Utils","AuthentiqAPI","AuthentiqButton","AuthentiqProvider","AuthentiqToken","AuthentiqSession","$log","log","aq","undefined","_defaults","_storage","state","nonce","id_token","session_state","direct_events","provider","provider_uri","authorize_path","end_session_path","check_session_iframe","client_id","signed_in","button","response_type","response_mode","redirect_uri","scope","display","prompt","ui_locales","display_errors","sign_in_text","sign_out_text","sign_out_claim","theme","defaults","Object","assign","attr","attr_name","keys","key","snippet","document","querySelector","split","join","hasAttribute","getAttribute","substr","slice","test","Event","name","subscribe","callback","Token","Provider","window","opener","authentiq","handlePopupCallback","getEventHistory","close","e","on","parent","handleModalCallback","popup_window","API","_API","signIn","bind","signOut","Button","Session","isSignedIn","init","el","opts","buttons","querySelectorAll","toLowerCase","i","len","length","fireEventsFromHistory","module","exports","Array","prototype","indexOf","s","j","this","Function","b","C","TypeError","a","f","call","arguments","_this","D","apply","concat","defineProperty","enumerable","configurable","writable","value","target","to","nextSource","keysArray","nextIndex","nextKey","desc","getOwnPropertyDescriptor","localStorage","setItem","removeItem","Storage","_setItem","base64urlEncode","str","btoa","unescape","encodeURIComponent","replace","base64urlDecode","decodeURIComponent","escape","atob","_valid_console_types","_skip_console_types","_event_registry","_emitted_events_FIFO","type","args","push","shift","console","element","eventName","eventHandler","ref_id","scopedEventHandler","addEventListener","attachEvent","off","removeEventListener","detachEvent","addEventInHistory","data","broadcast","item","setEventHistory","event_history","generateNonce","prngCrypto","crypto","msCrypto","getRandomValues","Uint8Array","arr","map","n","String","fromCharCode","decodeJWT","token","segments","error","error_description","headerSeg","payloadSeg","signatureSeg","header","JSON","parse","payload","signature","opt","hash_key","$aq","$storage_defaults","$provider_defaults","options","getElementById","pre_existing_iframe","styles_appended_in_DOM","style","createElement","className","innerHTML","getCssStyles","getElementsByTagName","appendChild","event","keyCode","removeModal","hash_keys","location","href","delim","origin","queryString","_iframe","_modal","authorize_args","required_opts","optional_opts","centerWindowCoordiantes","width","height","screenX","screenLeft","screenY","screenTop","g","outerWidth","documentElement","clientWidth","outerHeight","clientHeight","h","screen","left","parseInt","top","parentNode","removeChild","authorizeURL","params","option_keys","stringify","preventDefault","closed","open","focus","src","onclick","setAttribute","id","onload","body","Math","floor","random","$defaults","$API","$Provider","style_tag","innerText","eventsSubscribe","tagName","trim","scriptTag","renderButton","signedIn","signedOut","svgLogo","svg","themes","basic","orange","grey","white","css","profile","claim","claims","text","insertBefore","$Token","$Event","checkToken","updateBindedElements","_profile","_profile_exp","search_in_locations","loc","getItem","setSessionState","setIDToken","token_type","access_token","expires_in","code","removeHash","scrollV","scrollH","history","replaceState","title","pathname","search","scrollTop","scrollLeft","hash","decodedJWT","loadProfile","getIDToken","exp","filter_out_protocol_claims","forEach","current_time_since_epoch","Date","sessionRevokeAccess","revokeAccess","is_server_side_signed_in","els","dataset","authentiqProfileBind","destroy","getSessionState","_target_origin","_available_commands","_op_frame","unsubscribe","renderOPFrame","contentWindow","receiveMessage","iframe","existing_op_frame","postMessage","cmd","msg","ex","stat","source","global","definition","define","amd","channelName","$","channel","reset","version","channels","subscriber","context","c","l","p","ai","jo","cl","offset","splice","encode","strict","strictUriEncode","objectAssign","extract","ret","create","param","parts","val","isArray","obj","sort","result","val2","filter","x","toObject","shouldUseNative","test1","getOwnPropertyNames","test2","order2","test3","letter","hasOwnProperty","propIsEnumerable","propertyIsEnumerable","from","symbols","getOwnPropertySymbols","charCodeAt","toString","toUpperCase"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// authentiq-js.js\n// ------------------\n\n// script strict mode syntax\n'use strict';\n\nrequire('./polyfills.js');\nvar radio = require('radio');\nvar Utils = require('./utils');\nvar AuthentiqAPI = require('./api');\nvar AuthentiqButton = require('./button');\nvar AuthentiqProvider = require('./provider');\nvar AuthentiqToken = require('./token');\nvar AuthentiqSession = require('./session');\n\nif (DEBUG) {\n  var $log = Utils.log;\n}\n\n(function(aq, undefined) {\n\n  $log('timeEnd', '_loaded');\n\n  $log('time', 'execution');\n  $log('time', 'initFrame');\n  $log('time', 'renderFrame');\n  $log('time', 'rpFrame');\n  $log('time', 'opFrame');\n\n  aq._defaults = {\n    _storage: {\n      state: 'authentiq.request_state',\n      nonce: 'authentiq.request_nonce',\n      id_token: 'authentiq.id_token',\n      session_state: 'authentiq.session_state'\n    },\n\n    direct_events: false,\n\n    provider: {\n      provider_uri: 'https://connect.authentiq.io',\n      authorize_path: '/authorize',\n      end_session_path: '/authorize/logout',\n      check_session_iframe: '/authorize/iframe',\n\n      // OAuth2\n      client_id: '',\n\n      // used in order RP can use snippet even without an id_token\n      // RP server can then add this option to `true/yes/1`\n      signed_in: null\n    },\n\n    button: {\n      // OAuth2\n      response_type: 'id_token',\n      response_mode: 'fragment',\n      redirect_uri: '',\n      scope: '',              // if empty then let the OP use its default,\n                              // if set always append openid\n      state: '',\n\n      // OIDC\n      nonce: '',\n      display: 'modal',\n      prompt: '',\n      ui_locales: '',\n\n      // UI\n      display_errors: '',     // client|provider, provider is the default value in OP\n      sign_in_text: 'Sign in',\n      sign_out_text: 'Sign out',\n      sign_out_claim: 'first_name name email phone_number',\n\n      theme: 'basic'          // basic|orange|grey|white\n    }\n  };\n\n  // NOTE: Give a try to lodash\n  // https://lodash.com/docs#defaultsDeep\n\n  // extend user defaults with authentiq module defaults\n  if ('defaults' in aq) {\n    if (typeof aq.defaults.direct_events !== 'undefined') {\n      aq._defaults.direct_events = true;\n    }\n\n    // this exists only for BDD tests so as tests does not mess up with snippets localStorage\n    if (BDD_TESTS) {\n      aq._defaults._storage = Object.assign({}, aq._defaults._storage, aq.defaults._storage);\n    }\n\n    aq._defaults.provider = Object.assign({}, aq._defaults.provider, aq.defaults.provider);\n    aq._defaults.button = Object.assign({}, aq._defaults.button, aq.defaults.button);\n\n    // delete the user defaults as it was being merged\n    delete aq.defaults;\n  }\n\n  // load js script tag options from data-attrs\n  var snippet = document.querySelector('.authentiq-snippet'),\n      attr, attr_name, keys, key;\n\n  if (snippet) {\n    // -- Parse provider settings from script tag data attrs\n    // read only the public options\n    keys = ['provider', 'button'];\n    for (key in keys) {\n      for (attr in aq._defaults[keys[key]]) {\n        attr_name = 'data-' + attr.split('_').join('-');\n        if (snippet.hasAttribute(attr_name)) {\n          aq._defaults[keys[key]][attr] = snippet.getAttribute(attr_name);\n        }\n      }\n    }\n\n    // check if direct_events are set\n    if (snippet.hasAttribute('data-direct-events')) {\n      aq._defaults.direct_events = true;\n    }\n  }\n\n  // remove 'provider_uri' trailing slash\n  if(aq._defaults.provider.provider_uri.substr(-1) === '/') {\n    aq._defaults.provider.provider_uri = aq._defaults.provider.provider_uri.slice(0, -1);\n  }\n\n  // add 'authorize_path' and 'end_session_path' facing slash\n  keys = ['authorize_path', 'end_session_path', 'check_session_iframe'];\n  for (key in keys) {\n    if(aq._defaults.provider[keys[key]][0] !== '/') {\n      aq._defaults.provider[keys[key]] = '/' + aq._defaults.provider[keys[key]];\n    }\n  }\n\n  // used in order RP can use snippet even without an id_token\n  // accepts `true/yes/1` values for signed_in option\n  aq._defaults.provider.signed_in = /(true|yes|1)/i.test(aq._defaults.provider.signed_in);\n\n  // expose classes publicly\n  aq.Event = function(name) {\n    return radio('aq:' + name);\n  };\n\n  // add handy function so as devs can subscribe to our events.\n  aq.subscribe = function(name, callback) {\n    aq.Event(name).subscribe(callback);\n  };\n\n  aq.Token = new AuthentiqToken();\n  aq.Provider = new AuthentiqProvider();\n\n  // handle closing of popup\n  if (window.opener) {\n    // we need this `try` in case the main window has been opened from another page\n    // otherwise JS will throw an error stopping the execution\n    try {\n      if (window.opener.authentiq && window.opener.authentiq.handlePopupCallback) {\n        window.opener.authentiq.handlePopupCallback( Utils.getEventHistory() );\n      } else {\n        $log(\"Parent has no authentiq.handlePopupCallback() function to call.\");\n      }\n\n      // close this current window\n      try {\n        window.close();\n      } catch (e) {}\n\n      // iOS bug won't let us close a popup if still loading\n      Utils.on(window, 'load', function() {\n        window.close();\n      });\n\n      return;\n\n    } catch (e) {}\n  }\n\n  // handle closing of modal\n  if (window.parent && window.parent.authentiq && window.parent.authentiq.handleModalCallback)\n  {\n    // we need this `try` in case the main window has been opened from another page\n    // otherwise JS will throw an error stopping the execution\n    try {\n      window.parent.authentiq.handleModalCallback( Utils.getEventHistory() );\n      return;\n    } catch (e) {}\n  }\n\n  aq.popup_window = undefined;\n  aq.handlePopupCallback = undefined;\n  aq.handleModalCallback = undefined;\n\n  aq.API = AuthentiqAPI;\n  aq._API = new AuthentiqAPI();\n  aq.signIn = aq._API.signIn.bind(aq._API);\n  aq.signOut = aq.Provider.signOut;\n\n  aq.Button = AuthentiqButton;\n  aq.Session = new AuthentiqSession();\n\n  $log('timeEnd', '_warmup');\n  $log('Logged in: ', aq.Provider.isSignedIn());\n\n  // bind buttons on DOMReady event\n  // this will not be called when script loads in async mode\n  Utils.on(document, 'DOMContentLoaded', function() {\n    aq.init();\n  });\n\n  aq.init = function(el, opts) {\n    // initiate custom element\n    if (typeof el !== 'undefined') {\n      new AuthentiqButton(el, opts);\n\n    // or bootstrap existing elements\n    } else {\n      var buttons = document.querySelectorAll('.authentiq-button');\n\n      // generate button for script tag\n      if (snippet && /(true|yes|1)/i.test((snippet.getAttribute('data-button') || '').toLowerCase())) {\n        new AuthentiqButton(snippet, opts);\n      }\n\n      // generate buttons for DOM elements with class .authentiq-button\n      for (var i = 0, len = buttons.length; i < len; i++) {\n        new AuthentiqButton(buttons[i], opts);\n      }\n    }\n\n    // fire all events that happened before DOMContentLoaded\n    Utils.fireEventsFromHistory();\n\n    $log('timeEnd', 'execution');\n    $log('timeEnd', '_execution');\n  };\n\n  module.exports = aq;\n\n})(window.authentiq = window.authentiq || {});\n","\nvar Utils = require('./utils');\nif (DEBUG) {\n  var $log = Utils.log;\n}\n\n// // ES5 Object.create\n// if (!Object.create) {\n\n//   // Shim, Object create\n//   // A shim for Object.create(), it adds a prototype to a new object\n//   Object.create = (function() {\n\n//     function F() {}\n\n//     return function(o) {\n\n//       if (arguments.length != 1) {\n//         throw new Error('Object.create implementation only accepts one parameter.');\n//       }\n\n//       F.prototype = o;\n//       return new F();\n//     };\n\n//   })();\n// }\n\n// ES5 [].indexOf\nif (!Array.prototype.indexOf) {\n  Array.prototype.indexOf = function(s) {\n\n    for (var j = 0; j < this.length; j++) {\n      if (this[j] === s) {\n        return j;\n      }\n    }\n\n    return -1;\n  };\n}\n\n// // ES5 [].forEach\n// if (!Array.prototype.forEach) {\n//   Array.prototype.forEach = function(fun/*, thisArg*/) {\n\n//     if (this === void 0 || this === null) {\n//       throw new TypeError();\n//     }\n\n//     var t = Object(this);\n//     var len = t.length >>> 0;\n//     if (typeof fun !== 'function') {\n//       throw new TypeError();\n//     }\n\n//     var thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n//     for (var i = 0; i < len; i++) {\n//       if (i in t) {\n//         fun.call(thisArg, t[i], i, t);\n//       }\n//     }\n\n//     return this;\n//   };\n// }\n\n// // ES5 [].filter\n// if (!Array.prototype.filter) {\n//   Array.prototype.filter = function(fun, thisArg) {\n\n//     var a = [];\n//     this.forEach(function(val, i, t) {\n//       if (fun.call(thisArg || void 0, val, i, t)) {\n//         a.push(val);\n//       }\n//     });\n\n//     return a;\n//   };\n// }\n\n// // Production steps of ECMA-262, Edition 5, 15.4.4.19\n// // Reference: http://es5.github.io/#x15.4.4.19\n// if (!Array.prototype.map) {\n\n//   Array.prototype.map = function(fun, thisArg) {\n\n//     var a = [];\n//     this.forEach(function(val, i, t) {\n//       a.push(fun.call(thisArg || void 0, val, i, t));\n//     });\n\n//     return a;\n//   };\n// }\n\n// // ES5 isArray\n// if (!Array.isArray) {\n\n//   // Function Array.isArray\n//   Array.isArray = function(o) {\n//     return Object.prototype.toString.call(o) === '[object Array]';\n//   };\n// }\n\n// Test for location.assign\n// if (typeof window === 'object' && typeof window.location === 'object' && !window.location.assign) {\n\n//   window.location.assign = function(url) {\n//     window.location = url;\n//   };\n// }\n\n// Test for Function.bind\nif (!Function.prototype.bind) {\n\n  // MDN\n  // Polyfill IE8, does not support native Function.bind\n  Function.prototype.bind = function(b) {\n\n    if (typeof this !== 'function') {\n      throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n    }\n\n    function C() {}\n\n    var a = [].slice;\n    var f = a.call(arguments, 1);\n    var _this = this;\n    var D = function() {\n      return _this.apply(this instanceof C ? this : b || window, f.concat(a.call(arguments)));\n    };\n\n    C.prototype = this.prototype;\n    D.prototype = new C();\n\n    return D;\n  };\n}\n\nif (!Object.assign) {\n  Object.defineProperty(Object, 'assign', {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function(target) {\n      'use strict';\n      if (target === undefined || target === null) {\n        throw new TypeError('Cannot convert first argument to object');\n      }\n\n      var to = Object(target);\n      for (var i = 1; i < arguments.length; i++) {\n        var nextSource = arguments[i];\n        if (nextSource === undefined || nextSource === null) {\n          continue;\n        }\n        nextSource = Object(nextSource);\n\n        var keysArray = Object.keys(Object(nextSource));\n        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {\n          var nextKey = keysArray[nextIndex];\n          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);\n          if (desc !== undefined && desc.enumerable) {\n            to[nextKey] = nextSource[nextKey];\n          }\n        }\n      }\n      return to;\n    }\n  });\n}\n\n// Safari, in Private Browsing Mode, looks like it supports localStorage but all calls to setItem\n// throw QuotaExceededError. We're going to detect this and just silently drop any calls to setItem\n// to avoid the entire page breaking, without having to do a check at each usage of Storage.\nif (typeof localStorage === 'object') {\n  try {\n    localStorage.setItem('localStorage', 1);\n    localStorage.removeItem('localStorage');\n  } catch (e) {\n    Storage.prototype._setItem = Storage.prototype.setItem;\n    Storage.prototype.setItem = function() {};\n    $log('warn', 'Your web browser does not support storing settings locally. In Safari, the most common cause of this is using \"Private Browsing Mode\". Some settings may not save or some features may not work properly for you.');\n  }\n}\n","// utils.js\n// ------------------\n\nvar radio = require('radio');\n\nif (DEBUG) {\n  var _valid_console_types = ['log', 'info', 'warn', 'debug', 'error',\n                              'dir', 'table', 'trace',\n                              'group', 'groupCollapsed', 'groupEnd',\n                              'time', 'timeEnd'];\n\n  var _skip_console_types = ['time', 'timeEnd'];\n}\n\n// keep a registry dict for the binded events of buttons so as we can unbind them\nvar _event_registry = {};\n\n// keeps all radio emitted events that has been fired before DOMContentLoad event\n// so as to fire them right after as some JS frameworks (angular)\n// can't listen on these events before, as our script needs to load before\n//\n// NOTE: it won't be nice to ask devs to use JS dependency loaders\nvar _emitted_events_FIFO = [];\n\nfunction base64urlEncode(str) {\n  // cross browser compatible, but it adds 20Kb\n  // return new Buffer(str).toString('base64')\n  return btoa(unescape(encodeURIComponent(str)))\n                  .replace(/\\+/g, '-')\n                  .replace(/\\//g, '_')\n                  .replace(/=*$/, '');\n}\n\nfunction base64urlDecode(str) {\n  str += Array(5 - (str.length % 4 || 4)).join('=');\n  str = str.replace(/\\-/g, '+').replace(/_/g, '/');\n  return decodeURIComponent(escape(atob(str)));\n\n  // cross browser compatible, but it adds 20Kb\n  // return new Buffer(str, 'base64').toString();\n}\n\nmodule.exports = {\n  log: function() {\n    if (DEBUG && 'console' in window) {\n      var type, args = [];\n      Array.prototype.push.apply(args, arguments);\n\n      // check if log passed the log level as frist argument or fallback to 'log'\n      type = _valid_console_types.indexOf(arguments[0]) > -1 ? args.shift() : 'log';\n\n      // IMPORTANT: you can easily suspend all logging levels\n      // by setting '_valid_console_types'\n      if (_skip_console_types.indexOf(type) === -1) {\n        console[type].apply(console, args);\n      }\n    }\n  },\n\n  // addEventListener polyfill\n  on: function(element, eventName, eventHandler, scope) {\n    var ref_id,\n        scopedEventHandler = scope ? function(e) { eventHandler.apply(scope, [e]); } : eventHandler;\n\n    // at the moment we have a need to unbind only for button events\n    // so let's limit to this so as to keep size smaller\n    // ref_id = element.hasAttribute('data-authentiq-button') ? element.getAttribute('data-authentiq-button') : undefined;\n    ref_id = ('getAttribute' in element) ? element.getAttribute('data-authentiq-button') : element;\n\n    if (typeof ref_id !== 'undefined') {\n      if (typeof _event_registry[eventName] === 'undefined') {\n        _event_registry[eventName] = {};\n      }\n\n      if (typeof _event_registry[eventName][ref_id] === 'undefined') {\n        _event_registry[eventName][ref_id] = {};\n      }\n\n      _event_registry[eventName][ref_id][eventHandler] = scopedEventHandler;\n    }\n\n    if(document.addEventListener) {\n      element.addEventListener(eventName, scopedEventHandler, false);\n\n    } else if(document.attachEvent) {\n      element.attachEvent(\"on\" + eventName, scopedEventHandler);\n    }\n  },\n\n  off: function(element, eventName, eventHandler, scope) {\n    var ref_id, scopedEventHandler;\n\n    // at the moment we have a need to unbind only for button events\n    // so let's limit to this so as to keep size smaller\n    ref_id = ('getAttribute' in element) ? element.getAttribute('data-authentiq-button') : element;\n\n    if (typeof _event_registry[eventName] !== 'undefined' &&\n      typeof _event_registry[eventName][ref_id] !== 'undefined' &&\n      typeof _event_registry[eventName][ref_id][eventHandler] !== 'undefined')\n    {\n      // retrieve saved event handler\n      scopedEventHandler = _event_registry[eventName][ref_id][eventHandler];\n\n      if(document.removeEventListener) {\n        element.removeEventListener(eventName, scopedEventHandler, false);\n\n      } else if(document.detachEvent) {\n        element.detachEvent(\"on\" + eventName, scopedEventHandler);\n      }\n\n      delete _event_registry[eventName][ref_id][eventHandler];\n    }\n  },\n\n  addEventInHistory: function(name, data) {\n    // prepend `aq:` the in event name, as we use the radio class directly, instead of authentiq.Event\n    name = 'aq:' + name;\n\n    // if direct_events is true then emit the event directly\n    // and is not modal or popup view\n    if (authentiq._defaults.direct_events &&\n\n      // is not modal\n      !(window.parent && window.parent.authentiq && window.parent.authentiq.handleModalCallback) &&\n\n      // is not popup\n      !(window.opener && window.opener.authentiq && window.opener.authentiq.handlePopupCallback))\n    {\n      radio(name).broadcast(data);\n      return;\n    }\n\n    var item = {\n      'name': name,\n      'data': data\n    };\n\n    _emitted_events_FIFO.push(item);\n  },\n\n  setEventHistory: function(event_history) {\n    _emitted_events_FIFO = event_history;\n  },\n\n  getEventHistory: function() {\n    return _emitted_events_FIFO;\n  },\n\n  fireEventsFromHistory: function() {\n    // TODO: we can also check if there are subscribed instances\n    //       this will help for JS Frameworks like React\n\n    if (_emitted_events_FIFO.length > 0) {\n      for (var e in _emitted_events_FIFO) {\n        radio(_emitted_events_FIFO[e].name).broadcast(_emitted_events_FIFO[e].data);\n      }\n    }\n\n    // unset all items\n    _emitted_events_FIFO = [];\n  },\n\n  // NOTE: Client should supply their own (likely server generated) nonces if\n  // they want to support pre-crypto browsers.\n  generateNonce: function(len) {\n    // msCrypto: supports >IE11\n    var prngCrypto = window.crypto || window.msCrypto;\n    if (prngCrypto && typeof prngCrypto.getRandomValues === 'function' &&\n      (typeof Uint8Array === 'function' || typeof Uint8Array === 'object'))\n    {\n      var arr = new Uint8Array(len || 16);\n      prngCrypto.getRandomValues(arr);\n      var str = Array.prototype.map.call(arr,\n          function(n) { return String.fromCharCode(n); }).join('');\n      return base64urlEncode(str);\n    }\n\n    return;\n  },\n\n  //this is used to parse the profile\n  // function url_base64_decode(str) {\n  //   var output = str.replace('-', '+').replace('_', '/');\n  //   switch (output.length % 4) {\n  //     case 0:\n  //       break;\n  //     case 2:\n  //       output += '==';\n  //       break;\n  //     case 3:\n  //       output += '=';\n  //       break;\n  //     default:\n  //       throw 'Illegal base64url string!';\n  //   }\n  //   return window.atob(output); //polifyll https://github.com/davidchambers/Base64.js\n  // }\n\n  // var encodedProfile = data.token.split('.')[1];\n  //         var profile = JSON.parse(url_base64_decode(encodedProfile));\n\n  decodeJWT: function(token) {\n    var segments = token ? token.split('.') : [];\n\n    if (segments.length !== 3) {\n      // prepend `aq:` in event name, as we use the radio class directly, instead of authentiq.Event\n      radio('aq:error').broadcast({\n        error: 'client_error',\n        error_description: 'Failed to decode ID Token.'\n      });\n\n      this.log('Not enough or too many segments');\n\n      return;\n    }\n\n    // All segment should be base64\n    var headerSeg = segments[0];\n    var payloadSeg = segments[1];\n    var signatureSeg = segments[2];\n\n    // base64 decode and parse JSON\n    var header = JSON.parse(base64urlDecode(headerSeg)) || undefined;\n    var payload = JSON.parse(base64urlDecode(payloadSeg)) || undefined;\n\n    return {\n      header: header,\n      payload: payload,\n      signature: signatureSeg\n    };\n  }\n\n  // LICENSE (MIT) to: https://github.com/toddmotto/atomic\n  // xhr: function (type, url, data) {\n  //   var methods = {\n  //     success: function () {},\n  //     error: function () {}\n  //   };\n  //   var XHR = window.XMLHttpRequest || ActiveXObject;\n  //   var request = new XHR('MSXML2.XMLHTTP.3.0');\n  //   request.open(type, url, true);\n  //   request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n  //   request.onreadystatechange = function () {\n  //     if (request.readyState === 4) {\n  //       if (request.status >= 200 && request.status < 300) {\n  //         methods.success.apply(methods, request);\n  //       } else {\n  //         methods.error.apply(methods, request);\n  //       }\n  //     }\n  //   };\n  //   request.send(data);\n  //   var callbacks = {\n  //     success: function (callback) {\n  //       methods.success = callback;\n  //       return callbacks;\n  //     },\n  //     error: function (callback) {\n  //       methods.error = callback;\n  //       return callbacks;\n  //     }\n  //   };\n\n  //   return callbacks;\n  // }\n};\n","// api.js\n// ------------------\n\n// script strict mode syntax\n'use strict';\n\nvar queryString = require('query-string');\nvar Utils = require('./utils');\n\n// Shorthand\nvar $aq;\nvar $storage_defaults;\nvar $provider_defaults;\n\nif (DEBUG) {\n  var $log = Utils.log;\n}\n\nvar _iframe, _modal;\n\nvar authorize_args = {\n  required_opts: ['response_type', 'response_mode', 'client_id', 'redirect_uri', 'state'],\n\n  // aditional optional values are: max_age, id_token_hint, login_hint, acr_values\n  optional_opts: ['scope', 'nonce', 'display', 'prompt', 'ui_locales', 'display_errors']\n};\n\nvar styles_appended_in_DOM = false;\nvar pre_existing_iframe = false;\n\nvar getCssStyles = function() {\n  // add modal styles\n  return  '.authentiq-modal{' +\n            'position:fixed;' +\n            'left:0;' +\n            'top:0;' +\n            'width:100%;' +\n            'height:100%;' +\n            'z-index:9998;' +\n            'background-color:rgba(0,0,0,.3);' +\n            'transition:all .8s ease-in-out' +\n          '}' +\n\n          '#authentiq-session-frame{' +\n            'position:fixed;' +\n            'left:50%;' +\n            'top:50%;' +\n            'width:450px;' +\n            'height:650px;' +\n            'margin-top:-300px;' +\n            'margin-left:-250px;' +\n            'z-index:9999;' +\n          '}' +\n\n          '@media only screen and (max-width: 400px){' +\n            '#authentiq-session-frame{' +\n              'width:90vw;' +\n              'margin-left:-45vw;' +\n            '}' +\n          '}' +\n\n          '#authentiq-session-frame.loaded{' +\n            '-moz-box-shadow:0 0 30px 2px rgba(24,24,24,.3);' +\n            '-webkit-box-shadow:0 0 30px 2px rgba(24,24,24,.3);' +\n            'box-shadow:0 0 30px 2px rgba(24,24,24,.3)' +\n          '}';\n};\n\n// http://stackoverflow.com/a/4682246/543431\nvar centerWindowCoordiantes = function(width, height) {\n  var a = typeof window.screenX != 'undefined' ? window.screenX : window.screenLeft;\n  var i = typeof window.screenY != 'undefined' ? window.screenY : window.screenTop;\n  var g = typeof window.outerWidth != 'undefined' ? window.outerWidth : document.documentElement.clientWidth;\n  var f = typeof window.outerHeight != 'undefined' ? window.outerHeight: (document.documentElement.clientHeight - 22);\n  var h = (a < 0) ? window.screen.width + a : a;\n  var left = parseInt(h + ((g - width) / 2), 10);\n  var top = parseInt(i + ((f - height) / 2.5), 10);\n\n  return 'width=' + width +\n        ',height=' + height +\n        ',left=' + left +\n        ',top=' + top + ',';\n};\n\nvar removeModal = function() {\n  if (typeof _modal !== 'undefined') {\n    _modal.parentNode.removeChild(_modal);\n  }\n\n  _modal = undefined;\n  _iframe = undefined;\n};\n\nfunction AuthentiqAPI(opt) {\n  var hash_key,\n      opts = opt || {};\n\n  // keep reference to authentiq namespace\n  $aq = window.authentiq;\n\n  // keep reference to _storage default config\n  $storage_defaults = $aq._defaults._storage;\n  $provider_defaults = $aq._defaults.provider;\n\n  // merge element options with button defaults\n  this.options = Object.assign({}, $aq._defaults.button, opts);\n\n  if (document.getElementById('authentiq-session-frame')) {\n    pre_existing_iframe = true;\n  }\n\n  // if dev handles the iframe on his own skip styles and event bindings\n  if (!pre_existing_iframe) {\n\n    // load styles only once\n    if (!styles_appended_in_DOM) {\n      styles_appended_in_DOM = true;\n\n      // load CSS style\n      var style = document.createElement('style');\n      style.className = 'authentiq-styles';\n      style.innerHTML = getCssStyles();\n      document.getElementsByTagName('head')[0].appendChild(style);\n    }\n\n    // handle closing of modal when escape key is pressed\n    Utils.on(window, 'keydown', function (event) {\n      if (event.keyCode === 27) {\n        removeModal();\n      }\n    });\n  }\n\n  var hash_keys = ['state', 'nonce'];\n  for (hash_key in hash_keys) {\n    if (typeof this.options[hash_keys[hash_key]] === 'undefined' || this.options[hash_keys[hash_key]] === '') {\n      this.options[hash_keys[hash_key]] = Utils.generateNonce(8) || '';\n    }\n  }\n\n  // always append openid scope if it doesn't exist in scopes\n  if (typeof this.options.scope !== 'undefined' &&\n      this.options.scope !== '' && this.options.scope.indexOf('openid') === -1)\n  {\n    this.options.scope += ' openid';\n  }\n\n  if (typeof this.options.redirect_uri === 'undefined' || this.options.redirect_uri === '') {\n\n    // when redirect_uri is not set, snippet only accepts response_mode=fragment\n    this.options.response_mode = 'fragment';\n\n    this.options.redirect_uri = window.location.href.split('#')[0];\n\n  // handle relative redirect_uris\n  } else if (!/^https?:\\/\\//i.test(this.options.redirect_uri)) {\n    var delim = this.options.redirect_uri[0] !== '/' ? '/' : '';\n    this.options.redirect_uri = window.location.origin + delim + this.options.redirect_uri;\n  }\n}\n\nAuthentiqAPI.prototype.authorizeURL = function(opt) {\n  var params = {}, opts = opt || {}, options, key,\n      option_keys = authorize_args.required_opts.concat(authorize_args.optional_opts);\n\n  // merge passed options with instance defaults\n  options = Object.assign({}, this.options, opts);\n\n  // add vars for querystring\n  for (key in option_keys) {\n\n    // if is optional param and it has no value then don't add it\n    if (authorize_args.optional_opts.indexOf(option_keys[key]) > -1 && options[option_keys[key]] === '') {\n      continue;\n    }\n\n    //   params.push(encodeURIComponent(option_keys[key]) + \"=\" + encodeURIComponent(this.options[option_keys[key]]));\n    params[option_keys[key]] = options[option_keys[key]] || $provider_defaults[option_keys[key]];\n  }\n\n  // return this.options.provider_uri + \"?\" + params.join(\"&\");\n  return $provider_defaults.provider_uri + $provider_defaults.authorize_path + \"?\" + queryString.stringify(params);\n};\n\nAuthentiqAPI.prototype.signIn = function(event) {\n  if (typeof event !== 'undefined') {\n    event.preventDefault();\n  }\n\n  // set state cookie\n  localStorage.setItem($storage_defaults.state, this.options.state);\n\n  // set nonce cookie\n  localStorage.setItem($storage_defaults.nonce, this.options.nonce);\n\n  if (this.options.display === 'page') {\n    window.location.href = this.authorizeURL();\n\n  } else if (this.options.display === 'popup') {\n\n    // open popup or bring to focus\n    if (typeof $aq.popup_window === 'undefined' || $aq.popup_window.closed) {\n      // handle popup callback\n      $aq.handlePopupCallback = function(event_history) {\n\n        $aq.handlePopupCallback = undefined;\n        $aq.popup_window = undefined;\n\n        Utils.setEventHistory(event_history);\n\n        // fire all events that happened before DOMContentLoaded\n        Utils.fireEventsFromHistory();\n      };\n\n      $aq.popup_window = window.open(\n          this.authorizeURL(),\n          'Authentiq Connect',\n           centerWindowCoordiantes(450, 650) + 'scrollbars=1,location=0,toolbar=0,status=0,menubar=0,personalbar=0,resizable=0,dependent=1,dialog=0,close=1,modal=1'\n      );\n    }\n    else {\n      $aq.popup_window.focus();\n    }\n\n  } else {\n    // handle modal callback\n    $aq.handleModalCallback = function(event_history) {\n      removeModal();\n\n      $aq.handleModalCallback = undefined;\n\n      Utils.setEventHistory(event_history);\n\n      // fire all events that happened before DOMContentLoaded\n      Utils.fireEventsFromHistory();\n    };\n\n    if (pre_existing_iframe) {\n      document.getElementById('authentiq-session-frame').src = this.authorizeURL();\n\n    } else {\n      _modal = document.createElement('div');\n      _modal.className = 'authentiq-modal';\n\n      _modal.onclick = function () {\n        removeModal();\n      };\n\n      _iframe = document.createElement('iframe');\n      _iframe.setAttribute('frameBorder', '0');\n      _iframe.id = 'authentiq-session-frame';\n      _iframe.src = this.authorizeURL();\n\n      _iframe.onload = function () {\n        _iframe.className = 'loaded';\n      };\n\n      _modal.appendChild(_iframe);\n\n      document.body.appendChild(_modal);\n    }\n  }\n};\n\nmodule.exports = AuthentiqAPI;\n","// button.js\n// ------------------\n\n// script strict mode syntax\n'use strict';\n\nvar Utils = require('./utils');\n\n// Shorthand\nvar $aq;\nvar $defaults;\nvar $storage_defaults;\nvar $provider_defaults;\nvar $API;\nvar $Provider;\n\nif (DEBUG) {\n  var $log = Utils.log;\n}\n\nvar styles_appended_in_DOM = false;\n\nvar svgLogo = function(theme) {\n  // keep width/height attrs as they solve scaling issues at IE9/10\n  var svg = '<svg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 30 27\\' width=\\'30\\' height=\\'27\\'>' +\n    '<path id=\\'aq-logo-bg\\' style=\\'fill:'+ theme[3] +'\\' d=\\'M30 18.4c0 .7-.4 1.4-.8 1.7l-13.6 7H14L.8 20c-.4 0-.8-1-.8-1.5v-10C0 8 .4 7.3.8 7L14 0c.4-.3 1.2-.3 1.6 0l13.6 7c.4.2.8 1 .8 1.6v9.8z\\'/>' +\n    '<path id=\\'aq-logo-a\\' style=\\'fill:'+ theme[4] +'\\' d=\\'M11 13.7c0-1.8 1.3-3.3 3-3.3s3 1.5 3 3.3c0 1.8-1.3 3.2-3 3.2s-3-1.7-3-3.5zm11.5 3H22c-.4 0-1-.2-1-.4-.3 0-.5-.4-.5-.8V7.7h-3.2V9c-.5-.5-1-.8-1.7-1-.6-.3-1.5-.5-2.3-.5-1 0-1.7.2-2.4.5-1 .3-1.6.8-2 1.3-.6.6-1 1.2-1 2-.6.7-.7 1.5-.7 2.3 0 1 0 1.7.4 2.4.2.7.6 1.4 1 2 .6.5 1.2 1 2 1.3.6.3 1.4.5 2.3.5 1 0 1.8-.2 2.5-.6.7-.3 1.2-.8 1.7-1.5.3.6.7 1 1.3 1.5.5.4 1 .6 1.8.6.5 0 1 0 1.5-.2l.5-.2v-2.8z\\'/>' +\n  '</svg>';\n\n  // Encode <, >, #, any remaining \" and other known-unsafe-in-URLs characters\n  // tip: this fixes firefox\n  return svg.replace(/\"/g,'\\'')\n            .replace(/</g,'%3C')\n            .replace(/>/g,'%3E')\n            .replace(/&/g,'%26')\n            .replace(/#/g,'%23')\n            .replace(/\\s+/g,' ');\n};\n\nvar getCssStyles = function() {\n  // button themes\n  var themes = {\n    // name: [bg, text, hover-bg, primary, secondary]\n    // name: [bg, text, hover-bg, logo-bg, logo-char]\n    basic: ['#895fc0', '#fff', '#6a3fa1', '#fff', '#f05023'],\n    orange: ['#f05023', '#fff', '#cd380e', '#fff', '#f05023'],\n    grey: ['#afb6bb', '#333', '#919aa1', '#fff', '#f05023'],\n    white: ['#fff', '#444', '#d4d4d4', '#f05023', '#fff']\n  }, css = '', theme;\n\n  // add basic button styles\n  css +=  '.authentiq-button-style{' +\n            'padding:8px 8px 8px 46px;' +\n            'min-height:40px;' +\n            'background-color:' + themes.basic[0] + ';' +\n            'background-image:url(\"data:image/svg+xml;charset=utf8,'+ svgLogo(themes.basic) +'\") !important;' +\n            'background-size: 31px 28px !important;' +\n            'background-position: 8px center !important;' +\n            'background-repeat: no-repeat !important;' +\n            'color:' + themes.basic[1] + ';' +\n            'display:inline-block;' +\n            'border:0 none;' +\n            'border-radius:5px;' +\n            'font-family:\"Helvetica Neue\",Helvetica,Arial,sans-serif;font-weight:600;' +\n            'letter-spacing:.016em' +\n          '}' +\n\n          '.authentiq-button-style:hover,' +\n          '.authentiq-button-style:focus{' +\n          // '.authentiq-button-style:active{' +\n            'background-color:' + themes.basic[2] + ';' +\n            'color:' + themes.basic[1] +\n          '}';\n\n  // add theme styles\n  for (theme in themes) {\n\n    // skip default theme\n    if (theme == 'basic') continue;\n\n    css +=  '.authentiq-button-style.' + theme + '-theme{' +\n              'background-color:' + themes[theme][0] +';' +\n              'color:' + themes[theme][1] + ';' +\n\n              // add another SVG image only if needed\n              // so check if basic SVG logo is different from this theme one\n              (\n                (themes.basic[3] !== themes[theme][3] || themes.basic[4] !== themes[theme][4]) ? 'background-image: url(\"data:image/svg+xml;charset=utf8,' + svgLogo(themes[theme]) + '\") !important;' : ''\n              ) +\n            '}' +\n\n            '.authentiq-button-style.' + theme + '-theme:hover,' +\n            '.authentiq-button-style.' + theme + '-theme:focus{' +\n              'background-color:' + themes[theme][2] + ';' +\n              'color:' + themes[theme][1] +\n            '}';\n  }\n\n  return css;\n};\n\n// subscribed events callbacks\nvar signedIn = function(profile) {\n  profile = profile || {};\n\n  var claims = this.options.sign_out_claim.split(' '), claim,\n      text = this.options.sign_out_text;\n  for (claim in claims) {\n    if (profile[claims[claim]]) {\n      text += ' ' + profile[claims[claim]];\n      break;\n    }\n  }\n\n  // update text for signed in user\n  this.el.innerHTML = text;\n\n  // unbind pre-bind events from button\n  Utils.off(this.el, 'click', $Provider.signOut, this);\n  Utils.off(this.el, 'click', $API.signIn, this);\n\n  // bind click event\n  Utils.on(this.el, 'click', $Provider.signOut, this);\n};\n\nvar signedOut = function() {\n  // update text for signed in user\n  this.el.innerHTML = this.options.sign_in_text;\n\n  // unbind pre-bind events from button\n  Utils.off(this.el, 'click', $Provider.signOut, this);\n  Utils.off(this.el, 'click', $API.signIn, this);\n\n  // bind click event\n  Utils.on(this.el, 'click', $API.signIn, this);\n};\n\nvar eventsSubscribe = function() {\n  $aq.Event('profile').subscribe([signedIn, this]);\n  $aq.Event('concluded').subscribe([signedOut, this]);\n};\n\n// var AuthentiqButton = (function() {\nfunction AuthentiqButton(el, opt) {\n  var attr, attr_name, hash_key,\n      opts = opt || {};\n\n  // check if element is already initialized\n  if (el !== 'undefined' && el.hasAttribute('data-authentiq-button')) {\n    return;\n  }\n\n  // create a random button id\n  this.id = Math.floor(Math.random() * (9999 - 1000 + 1)) + 1000;\n\n  // keep reference to authentiq namespace\n  $aq = window.authentiq;\n\n  // keep reference to _storage default config\n  $defaults = $aq._defaults.button;\n  $storage_defaults = $aq._defaults._storage;\n  $provider_defaults = $aq._defaults.provider;\n\n  $API = $aq._API;\n  $Provider = $aq.Provider;\n\n  // handy refs to API functions which uses the context `this` from the button\n  this.authorizeURL = $API.authorizeURL;\n  this.signIn = $API.signIn;\n\n  if (!styles_appended_in_DOM) {\n    styles_appended_in_DOM = true;\n\n    // add CSS styles, a style tag exists\n    var style_tag = document.querySelector('.authentiq-styles');\n    if (style_tag) {\n      style_tag.innerText += getCssStyles();\n    }\n  }\n\n  // subscribe to events\n  eventsSubscribe.apply(this);\n\n  // merge element options with button defaults\n  this.options = Object.assign({}, $defaults, opts);\n\n  // read only the public options\n  for (attr in this.options) {\n    attr_name = 'data-' + attr.split('_').join('-');\n    if (el.hasAttribute(attr_name)) {\n      this.options[attr] = el.getAttribute(attr_name);\n    }\n  }\n\n  // get signed in text from button if is same as default\n  if (this.options.sign_in_text === $defaults.sign_in_text && el.tagName.toLowerCase() !== 'script' && el.innerHTML.trim() !== '') {\n    this.options.sign_in_text = el.innerHTML.trim();\n  }\n\n  var hash_keys = ['state', 'nonce'];\n  for (hash_key in hash_keys) {\n    if (this.options[hash_keys[hash_key]] === '') {\n      this.options[hash_keys[hash_key]] = Utils.generateNonce(8) || '';\n    }\n  }\n\n  // always append openid scope if it doesn't exist in scopes\n  if (this.options.scope !== '' && this.options.scope.indexOf('openid') === -1) {\n    this.options.scope += ' openid';\n  }\n\n  if (this.options.redirect_uri === '') {\n\n    // when redirect_uri is not set, snippet only accepts response_mode=fragment\n    this.options.response_mode = 'fragment';\n\n    this.options.redirect_uri = window.location.href.split('#')[0];\n\n  // handle relative redirect_uris\n  } else if (!/^https?:\\/\\//i.test(this.options.redirect_uri)) {\n    var delim = this.options.redirect_uri[0] !== '/' ? '/' : '';\n    this.options.redirect_uri = window.location.origin + delim + this.options.redirect_uri;\n  }\n\n  if (el.tagName.toLowerCase() === 'script') {\n    this.scriptTag = el;\n    this.renderButton();\n  } else {\n    this.el = el;\n  }\n\n  // add class to button for styling purposes\n  if (this.el.className.indexOf('authentiq-button') === -1) {\n    this.el.className += ' authentiq-button';\n  }\n\n  // add theme support\n  if (this.options.theme && this.options.theme !== 'none') {\n    this.el.className += ' authentiq-button-style ' + this.options.theme + '-theme';\n  }\n\n  // initialize the button\n\n  // mark the element as initiated, with a unique id\n  this.el.setAttribute('data-authentiq-button', this.id);\n\n  // update text and bind events\n  if ($Provider.isSignedIn()) {\n    signedIn.apply(this);\n  } else {\n    signedOut.apply(this);\n  }\n\n  // later unsubscribe events when buttons are removed\n  //\n  // DOMNodeRemoved DOMNodeRemovedFromDocument\n  // Utils.on(this.el, 'DOMNodeRemovedFromDocument', function(event) {\n  //   // console.log('*************************', event);\n  //   $aq.Event('profile').unsubscribe(signedIn);\n  //   $aq.Event('concluded').unsubscribe(signedOut);\n  // });\n}\n\n// Render the button\nAuthentiqButton.prototype.renderButton = function() {\n\n  // Create wrapper div and apply styles/class\n  this.el = document.createElement('button');\n\n  this.scriptTag.parentNode.insertBefore(this.el, this.scriptTag);\n};\n\nmodule.exports = AuthentiqButton;\n","// provider.js\n// ------------------\n\n// script strict mode syntax\n'use strict';\n\n// private vars and functions\nvar queryString = require('query-string');\nvar Utils = require('./utils');\n\n// Shorthand\nvar $aq;\nvar $Token;\nvar $Event;\nvar $storage_defaults;\n\nif (DEBUG) {\n  var $log = Utils.log;\n}\n\n// private vars\nvar _profile;\nvar _profile_exp;   // we keep in memory the id_token.exp as it is being removed from profile\n\nvar checkToken = function() {\n  var token, state, nonce, profile,\n      search_in_locations = ['hash', 'search'];\n\n  for (var loc in search_in_locations) {\n\n    if (location[ search_in_locations[loc] ]) {\n      token = queryString.parse(location[ search_in_locations[loc] ]) || {};\n\n      // check if OP returned an error\n      if ('error' in token)\n      {\n        Utils.addEventInHistory('error', {\n          error: token.error,\n          error_description: token.error_description || null\n        });\n\n      // check if it is a valid token for id_token\n      } else if ('state' in token &&\n        ('id_token' in token || 'access_token' in token || 'code' in token))\n      {\n\n        // get stored state send in OP\n        // and validate it with the response state\n        state = localStorage.getItem($storage_defaults.state);\n\n        if(token.state === state) {\n\n          // store session_state which needed for Session check (opframe)\n          $Token.setSessionState(token.session_state);\n\n          if ('id_token' in token) {\n            // get stored nonce send in OP\n            // and validate it with the id_token nonce\n            nonce = localStorage.getItem($storage_defaults.nonce);\n            profile = decodeJWT(token.id_token);\n\n            // remove strict validation of nonce for now\n            if (typeof profile !== 'undefined') // &&\n              // 'nonce' in profile && profile.nonce == nonce)\n            {\n              $Token.setIDToken(token.id_token);\n\n              // publish event\n              Utils.addEventInHistory('authorized:id_token', token.id_token);\n\n              if (typeof profile.nonce === 'undefined' || profile.nonce != nonce) {\n                Utils.addEventInHistory('error', {\n                  error: 'client_error',\n                  error_description: 'Invalid nonce in ID Token.'\n                });\n              }\n            }\n          }\n\n          if ('token_type' in token && 'access_token' in token) {\n            // TODO: validate access_token crypto hash left part === id_token.at_hash\n\n            // publish event\n            Utils.addEventInHistory('authorized:access_token', {\n              token_type: token.token_type,\n              access_token: token.access_token,\n              expires_in: parseInt(token.expires_in, 0) || 0\n            });\n          }\n\n          if ('code' in token) {\n            // publish event\n            Utils.addEventInHistory('authorized:code', token.code);\n          }\n\n          // publish event\n          Utils.addEventInHistory('authorized', token);\n\n        } else {\n          Utils.addEventInHistory('error', {\n            error: 'client_error',\n            error_description: 'Invalid state in authorization response.'\n          });\n        }\n\n        // delete the state, nonce cookie as it is not needed anymore\n        localStorage.removeItem($storage_defaults.state);\n        localStorage.removeItem($storage_defaults.nonce);\n\n        // replace location hash as it is not needed for the user\n        // when token found in fragments\n        if (search_in_locations[loc] == 'hash') {\n          removeHash();\n        }\n\n        break;\n      }\n    }\n  }\n};\n\nvar removeHash = function() {\n  var scrollV, scrollH, loc = window.location;\n  if ('pushState' in history) {\n      history.replaceState('', document.title, loc.pathname + loc.search);\n\n  } else {\n      // Prevent scrolling by storing the page's current scroll offset\n      scrollV = document.body.scrollTop;\n      scrollH = document.body.scrollLeft;\n\n      loc.hash = '';\n\n      // Restore the scroll offset, should be flicker free\n      document.body.scrollTop = scrollV;\n      document.body.scrollLeft = scrollH;\n  }\n};\n\nvar decodeJWT = function(token) {\n  var decodedJWT = token ? Utils.decodeJWT(token) : undefined;\n  return decodedJWT ? decodedJWT.payload : undefined;\n};\n\nvar loadProfile = function() {\n  if (typeof _profile === 'undefined') {\n    _profile = decodeJWT($Token.getIDToken());\n\n    // this will be executed only once, when id_token is loaded from localStorage\n    if (typeof _profile !== 'undefined') {\n      // keep a ref to _profile.exp time\n      _profile_exp = _profile.exp || undefined;\n\n      // remove all protocol claims from profile\n      var filter_out_protocol_claims = ['iss', 'sub', 'aud', 'exp', 'iat', 'nbf',\n                                        'auth_time', 'nonce', 'acr', 'amr', 'azp',\n                                        'jti', 'at_hash', 'idp',\n                                        '_claim_names', '_claim_sources'];\n      filter_out_protocol_claims.forEach(function(key){\n        delete _profile[key];\n      });\n    }\n  }\n\n  // this will be executed each time func is called and _profile is set\n  if (typeof _profile !== 'undefined') {\n    // For more information on the `+new`, check at\n    // http://stackoverflow.com/questions/9430357/please-explain-why-and-how-new-date-works-as-workaround-for-date-now-in\n    //\n    // check if id_token is expired, and signout the user if true\n    var current_time_since_epoch = Math.floor(+new Date() / 1000);\n    if (typeof _profile_exp === 'undefined' || current_time_since_epoch >= _profile_exp) {\n\n      // revoke token\n      this.signOut();\n\n      // send a revoke postMessage to opFrame\n      sessionRevokeAccess();\n\n      return;\n    }\n  }\n\n  return _profile;\n};\n\n// send a revoke postMessage to opFrame\nvar sessionRevokeAccess = function() {\n  if (typeof $aq.Session !== 'undefined') {\n    $aq.Session.revokeAccess.apply($aq.Session);\n  }\n};\n\n// public API\nfunction AuthentiqProvider(opt) {\n  var opts = opt || {};\n\n  // keep reference to authentiq namespace\n  $aq = window.authentiq;\n\n  // keep reference to _storage default config\n  $storage_defaults = $aq._defaults._storage;\n\n  $Token = $aq.Token;\n  $Event = $aq.Event;\n\n  // check if we have an OP redirect fragment\n  checkToken.call(this);\n\n  // update HTML entities that are binded to form updates\n  $Event('profile').subscribe([this.updateBindedElements, this]);\n\n  // trigger profile update\n  this.profile();\n}\n\n/**\n* Verifies if the `user` is authenticated or not based on the `token`.\n*\n* @return {boolean}\n*/\nAuthentiqProvider.prototype.isSignedIn = function() {\n  // server-side code can set user as signed in using `data-signed-in`\n  var is_server_side_signed_in = $aq._defaults.provider.signed_in || false;\n\n  return is_server_side_signed_in || !!loadProfile.apply(this);\n};\n\n/**\n* Decodes the `id_token` and returns the profile if set.\n* Also, it emits the `aq:profile` event.\n*\n* @return {object} or {undefined}\n*/\nAuthentiqProvider.prototype.profile = function() {\n\n  var profile = loadProfile.apply(this);\n\n  if (typeof profile !== 'undefined') {\n\n    // publish event\n    Utils.addEventInHistory('profile', profile);\n  }\n\n  return profile;\n};\n\n/**\n* Updates all the binded elements in HTML DOM\n*/\nAuthentiqProvider.prototype.updateBindedElements = function() {\n  var els, i, claim,\n      profile = loadProfile.apply(this);\n\n  els = document.querySelectorAll('[data-authentiq-profile-bind]');\n  for (i = 0; i < els.length; ++i) {\n    claim = els[i].dataset.authentiqProfileBind || '';\n    if (profile[claim]) {\n      if (typeof els[i].value !== 'undefined') {\n        els[i].value = profile[claim];\n      } else {\n        els[i].innerHTML = profile[claim];\n      }\n    }\n  }\n};\n\n/**\n * Revokes the `token` and removes the stored `token` from localStorage.\n * Also, it emits the `aq:concluded` event.\n */\nAuthentiqProvider.prototype.signOut = function(e) {\n\n  // if RP has initiated the signout then let the OP update its status\n  if (typeof e !== 'undefined') {\n    e.preventDefault();\n\n    // send a revoke postMessage to opFrame\n    sessionRevokeAccess();\n  }\n\n  // remove token cookie\n  $Token.destroy();\n\n  _profile = undefined;\n\n  // publish event\n  $Event('concluded').broadcast();\n};\n\n// this exists only for BDD tests\nif (BDD_TESTS) {\n  // for testing the fragment parsing\n  AuthentiqProvider.prototype.checkToken = function(e) {\n    checkToken.call(this);\n  };\n}\n\nmodule.exports = AuthentiqProvider;\n","// token.js\n// ------------------\n\n// script strict mode syntax\n'use strict';\n\n// var Cookies = require('cookies-js');\nvar Utils = require('./utils');\n\n// Shorthand\nvar $aq;\nvar $defaults;\n\nif (DEBUG) {\n  var $log = Utils.log;\n}\n\nfunction AuthentiqToken() {\n\n  // keep reference to authentiq namespace\n  $aq = window.authentiq;\n\n  // keep reference to _storage default config\n  $defaults = $aq._defaults._storage;\n}\n\n/**\n * Set IDToken\n */\nAuthentiqToken.prototype.setIDToken = function(id_token) {\n  localStorage.setItem($defaults.id_token, id_token);\n};\n\n/**\n * Get IDToken\n */\nAuthentiqToken.prototype.getIDToken = function() {\n  return localStorage.getItem($defaults.id_token) || undefined;\n};\n\n/**\n * Set Session State\n */\nAuthentiqToken.prototype.setSessionState = function(session_state) {\n  localStorage.setItem($defaults.session_state, session_state);\n};\n\n/**\n * Get Session State\n */\nAuthentiqToken.prototype.getSessionState = function() {\n  return localStorage.getItem($defaults.session_state) || undefined;\n};\n\n/**\n * Remove token\n */\nAuthentiqToken.prototype.destroy = function() {\n  localStorage.removeItem($defaults.id_token);\n  localStorage.removeItem($defaults.session_state);\n};\n\nmodule.exports = AuthentiqToken;\n","// session.js\n// ------------------\n\n// script strict mode syntax\n'use strict';\n\n// private vars and functions\nvar Utils = require('./utils');\n\n// Shorthand\nvar $aq;\nvar $provider_defaults;\nvar $Token;\n\nif (DEBUG) {\n  var $log = Utils.log;\n}\n\n// TODO:\n// Upon receipt of changed, the RP MUST perform re-authentication with prompt=none to obtain the current session state at the OP. Upon receipt of error, the RP MUST NOT perform re-authentication with prompt=none, so as to not cause potential infinite loops that generate network traffic to the OP.\n\n// When the RP detects a session state change, it SHOULD first try a prompt=none request within an iframe to obtain a new ID Token and session state, sending the old ID Token as the id_token_hint. If the RP receives an ID token for the same End-User, it SHOULD simply update the value of the session state. If it doesn't receive an ID token or receives an ID token for another End-User, then it needs to handle this case as a logout for the original End-User.\n// Note that the session state is origin bound. Session state SHOULD be returned upon an authentication failure.\n\n// the provider frame\nvar _target_origin;\nvar _available_commands = ['concluded'];\nvar _op_frame;\n\n// public API\nfunction AuthentiqSession() {\n\n  // keep reference to authentiq namespace\n  $aq = window.authentiq;\n\n  this.init();\n\n  // on signed_out event prepare the Session module for a new session\n  $aq.Event('concluded').subscribe([this.destroy, this]);\n}\n\nAuthentiqSession.prototype.init = function() {\n  // if already signed-in then start iFrame\n  if ($aq.Provider.isSignedIn() && !!$aq.Token.getSessionState()) {\n    // unsubscribe for handling iFrame init on sign in\n    $aq.Event('profile').unsubscribe(this.init);\n\n    // keep reference to provider default config\n    $provider_defaults = $aq._defaults.provider;\n\n    $Token = $aq.Token;\n\n    _target_origin = $provider_defaults.provider_uri;\n\n    _op_frame = this.renderOPFrame().contentWindow;\n    Utils.on(window, 'message', this.receiveMessage, this);\n\n  // wait for the user to sign-in first\n  } else {\n    $aq.Event('profile').unsubscribe(this.init).subscribe([this.init, this]);\n  }\n};\n\nAuthentiqSession.prototype.destroy = function() {\n  Utils.off(window, 'message', this.receiveMessage, this);\n\n  this.init();\n};\n\nAuthentiqSession.prototype.renderOPFrame = function() {\n  var iframe, existing_op_frame,\n      postMessage = this.postMessage;\n\n  $log('timeEnd', 'initFrame');\n  $log('timeEnd', '_initFrame');\n\n  // if iFrame exists already then use this one\n  existing_op_frame = document.querySelector('.opframe');\n  if (existing_op_frame) {\n    // force reload of opFrame so as we can bind the new session\n    existing_op_frame.src = $provider_defaults.provider_uri + $provider_defaults.check_session_iframe;\n\n    return existing_op_frame;\n  }\n\n  iframe = document.createElement('iframe');\n  iframe.setAttribute('frameBorder', '0');\n  iframe.style.display = 'none';\n\n  iframe.onload = function() {\n    // set the contentWindow to opFrame\n    _op_frame = this.contentWindow;\n\n    // check status with opFrame\n    postMessage();\n  };\n\n  iframe.className = 'opframe';\n  iframe.src = $provider_defaults.provider_uri + $provider_defaults.check_session_iframe;\n\n  try {\n    document.body.appendChild(iframe);\n  }\n  catch (e) {\n    Utils.on(document, 'DOMContentLoaded', function() {\n      (document.body || document.documentElement).appendChild(iframe);\n    });\n  }\n\n  $log('timeEnd', 'renderFrame');\n  $log('timeEnd', '_renderFrame');\n\n  return iframe;\n};\n\n// sends a revoke postMessage to opFrame\nAuthentiqSession.prototype.revokeAccess = function() {\n  this.postMessage('concluded');\n};\n\nAuthentiqSession.prototype.postMessage = function(cmd) {\n  $log('timeEnd', 'rpFrame');\n\n  // send a check session msg\n  var msg = $provider_defaults.client_id + ' ' + $Token.getSessionState();\n\n  // if cmd is set then append a cmd to postMessage\n  if (typeof cmd !== 'undefined' && _available_commands.indexOf(cmd) > -1) {\n    msg += ' ' + cmd;\n  }\n\n  $log('warn', 'RP: Sending message to ' + _target_origin + ': ' + msg);\n\n  try {\n    _op_frame.postMessage(msg, _target_origin);\n  }\n  catch(ex) {\n     $log('warn', 'RP: postMessage failed to be send');\n  }\n};\n\nAuthentiqSession.prototype.receiveMessage = function(e) {\n  var stat;\n\n  // do not accept message from an unexpected origin or frame\n  if (e.origin !== _target_origin || e.source != _op_frame) {\n    $log('warn', 'RP: Invalid origin ' + e.origin);\n    return;\n  }\n\n  $log('timeEnd', 'opFrame');\n  $log('timeEnd', '_iFrame');\n\n  $log('warn', 'RP: Received msg from ' + e.origin + ': ' + e.data);\n\n  stat = e.data;\n\n  // Authentiq\n  if (stat === 'changed') {\n      $log('warn', 'RP: Received changed state');\n      // var iframe_src = targetOrigin + '/authorize/?prompt=none&id_token_hint=' + $Token.getIDToken();\n      // this.renderFrame(iframe_src);\n\n      // TODO: how can we update the token?\n\n  } else if (stat === 'concluded') {\n      $log('warn', 'RP: Received logout state');\n      $aq.Provider.signOut();\n  }\n};\n\nmodule.exports = AuthentiqSession;\n","/**\n Radio.js - Chainable, Dependency Free Publish/Subscribe for Javascript\n http://radio.uxder.com\n Author: Scott Murphy 2011\n twitter: @hellocreation, github: uxder\n \n Permission is hereby granted, free of charge, to any person\n obtaining a copy of this software and associated documentation\n files (the \"Software\"), to deal in the Software without\n restriction, including without limitation the rights to use,\n copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the\n Software is furnished to do so, subject to the following\n conditions:\n \n The above copyright notice and this permission notice shall be\n included in all copies or substantial portions of the Software.\n \n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n OTHER DEALINGS IN THE SOFTWARE.\n */\n(function (name, global, definition) {\n  if (typeof module !== 'undefined') module.exports = definition(name, global);\n  else if (typeof define === 'function' && typeof define.amd  === 'object') define(definition);\n  else global[name] = definition(name, global);\n})('radio', this, function (name, global) {\n\n  \"use strict\";\n\n  /**\n   * Main Wrapper for radio.$ and create a function radio to accept the channelName\n   * @param {String} channelName topic of event\n   */\n  function radio(channelName) {\n    arguments.length ? radio.$.channel(channelName) : radio.$.reset();\n    return radio.$;\n  }\n\n  radio.$ = {\n    version: '0.2',\n    channelName: \"\",\n    channels: [],\n\n    /**\n     * Reset global state, by removing all channels\n     * @example\n     *    radio()\n     */\n    reset: function() {\n      radio.$.channelName = \"\";\n      radio.$.channels = [];\n    },\n \n    /**\n     * Broadcast (publish)\n     * Iterate through all listeners (callbacks) in current channel and pass arguments to subscribers\n     * @param arguments data to be sent to listeners\n     * @example\n     *    //basic usage\n     *    radio('channel1').broadcast('my message'); \n     *    //send an unlimited number of parameters\n     *    radio('channel2').broadcast(param1, param2, param3 ... );\n     */\n    broadcast: function() {\n      // use slice() so as to loop on a copy of channels list as it might be changed while looping\n      var i, c = this.channels[this.channelName].slice(),\n        l = c.length,\n        subscriber, callback, context;\n      //iterate through current channel and run each subscriber\n      for (i = 0; i < l; i++) {\n        subscriber = c[i];\n        //if subscriber was an array, set the callback and context.\n        if ((typeof(subscriber) === 'object') && (subscriber.length)) {\n          callback = subscriber[0];\n          //if user set the context, set it to the context otherwise, it is a globally scoped function\n          context = subscriber[1] || global;\n        }\n        callback.apply(context, arguments);\n      }\n      return this;\n    },\n\n    /**\n     * Create the channel if it doesn't exist and set the current channel/event name\n     * @param {String} name the name of the channel\n     * @example\n     *    radio('channel1');\n     */\n    channel: function(name) {\n      var c = this.channels;\n      //create a new channel if it doesn't exists\n      if (!c[name]) c[name] = [];\n      this.channelName = name;\n      return this;\n    },\n\n    /**\n     * Add Subscriber to channel\n     * Take the arguments and add it to the this.channels array.\n     * @param {Function|Array} arguments list of callbacks or arrays[callback, context] separated by commas\n     * @example\n     *      //basic usage\n     *      var callback = function() {};\n     *      radio('channel1').subscribe(callback); \n     *\n     *      //subscribe an endless amount of callbacks\n     *      radio('channel1').subscribe(callback, callback2, callback3 ...);\n     *\n     *      //adding callbacks with context\n     *      radio('channel1').subscribe([callback, context],[callback1, context], callback3);\n     *     \n     *      //subscribe by chaining\n     *      radio('channel1').subscribe(callback).radio('channel2').subscribe(callback).subscribe(callback2);\n     */\n    subscribe: function() {\n      var a = arguments,\n        c = this.channels[this.channelName],\n        i, l = a.length,\n        p, ai = [];\n\n      //run through each arguments and subscribe it to the channel\n      for (i = 0; i < l; i++) {\n        ai = a[i];\n        //if the user sent just a function, wrap the fucntion in an array [function]\n        p = (typeof(ai) === \"function\") ? [ai] : ai;\n        if ((typeof(p) === 'object') && (p.length)) c.push(p);\n      }\n      return this;\n    },\n\n    /**\n     * Remove subscriber from channel\n     * Take arguments with functions and unsubscribe it if there is a match against existing subscribers.\n     * @param {Function} arguments callbacks separated by commas\n     * @example\n     *      //basic usage\n     *      radio('channel1').unsubscribe(callback); \n     *      //you can unsubscribe as many callbacks as you want\n     *      radio('channel1').unsubscribe(callback, callback2, callback3 ...);\n     *       //removing callbacks with context is the same\n     *      radio('channel1').subscribe([callback, context]).unsubscribe(callback);\n     */\n    unsubscribe: function() {\n      var a = arguments,\n        i, j, c = this.channels[this.channelName],\n        l = a.length,\n        cl = c.length,\n        offset = 0,\n        jo;\n      //loop through each argument\n      for (i = 0; i < l; i++) {\n        //need to reset vars that change as the channel array items are removed\n        offset = 0;\n        cl = c.length;\n        //loop through the channel\n        for (j = 0; j < cl; j++) {\n          jo = j - offset;\n          //if there is a match with the argument and the channel function, unsubscribe it from the channel array\n          if (c[jo][0] === a[i]) {\n            //unsubscribe matched item from the channel array\n            c.splice(jo, 1);\n            offset++;\n          }\n        }\n      }\n      return this;\n    }\n  };\n\n  return radio;\n});","'use strict';\nvar strictUriEncode = require('strict-uri-encode');\nvar objectAssign = require('object-assign');\n\nfunction encode(value, opts) {\n\tif (opts.encode) {\n\t\treturn opts.strict ? strictUriEncode(value) : encodeURIComponent(value);\n\t}\n\n\treturn value;\n}\n\nexports.extract = function (str) {\n\treturn str.split('?')[1] || '';\n};\n\nexports.parse = function (str) {\n\t// Create an object with no prototype\n\t// https://github.com/sindresorhus/query-string/issues/47\n\tvar ret = Object.create(null);\n\n\tif (typeof str !== 'string') {\n\t\treturn ret;\n\t}\n\n\tstr = str.trim().replace(/^(\\?|#|&)/, '');\n\n\tif (!str) {\n\t\treturn ret;\n\t}\n\n\tstr.split('&').forEach(function (param) {\n\t\tvar parts = param.replace(/\\+/g, ' ').split('=');\n\t\t// Firefox (pre 40) decodes `%3D` to `=`\n\t\t// https://github.com/sindresorhus/query-string/pull/37\n\t\tvar key = parts.shift();\n\t\tvar val = parts.length > 0 ? parts.join('=') : undefined;\n\n\t\tkey = decodeURIComponent(key);\n\n\t\t// missing `=` should be `null`:\n\t\t// http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters\n\t\tval = val === undefined ? null : decodeURIComponent(val);\n\n\t\tif (ret[key] === undefined) {\n\t\t\tret[key] = val;\n\t\t} else if (Array.isArray(ret[key])) {\n\t\t\tret[key].push(val);\n\t\t} else {\n\t\t\tret[key] = [ret[key], val];\n\t\t}\n\t});\n\n\treturn ret;\n};\n\nexports.stringify = function (obj, opts) {\n\tvar defaults = {\n\t\tencode: true,\n\t\tstrict: true\n\t};\n\n\topts = objectAssign(defaults, opts);\n\n\treturn obj ? Object.keys(obj).sort().map(function (key) {\n\t\tvar val = obj[key];\n\n\t\tif (val === undefined) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (val === null) {\n\t\t\treturn encode(key, opts);\n\t\t}\n\n\t\tif (Array.isArray(val)) {\n\t\t\tvar result = [];\n\n\t\t\tval.slice().forEach(function (val2) {\n\t\t\t\tif (val2 === undefined) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (val2 === null) {\n\t\t\t\t\tresult.push(encode(key, opts));\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(encode(key, opts) + '=' + encode(val2, opts));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn result.join('&');\n\t\t}\n\n\t\treturn encode(key, opts) + '=' + encode(val, opts);\n\t}).filter(function (x) {\n\t\treturn x.length > 0;\n\t}).join('&') : '';\n};\n","'use strict';\n/* eslint-disable no-unused-vars */\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (e) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (Object.getOwnPropertySymbols) {\n\t\t\tsymbols = Object.getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","'use strict';\nmodule.exports = function (str) {\n\treturn encodeURIComponent(str).replace(/[!'()*]/g, function (c) {\n\t\treturn '%' + c.charCodeAt(0).toString(16).toUpperCase();\n\t});\n};\n"]}